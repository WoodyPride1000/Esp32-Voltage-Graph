概要


このプロジェクトは、ESP32 を使用して4つのアナログ入力（電圧）を監視し、そのデータをWebインターフェースでリアルタイムに表示するシステムです。
取得したデータは10秒ごとにサンプリングされ、10分ごとの平均値も計算・保持されます。

WebインターフェースはChart.jsを用いたグラフ表示に対応しており、最新の30サンプルを視覚的に確認できます。
また、蓄積された最大12時間分の全生データおよび10分ごとの平均データをCSV形式でダウンロードする機能も備わっています。

消費電力を抑えるため、サンプリング間隔中はライトスリープモードに移行し、Webサーバー機能は維持しつつ、CPUの動作を一時停止します。
Wi-Fi接続は非同期で管理され、接続状態をLEDで通知します。



取扱説明書
1. データの表示

Webブラウザでアクセス: ESP32がWi-Fiネットワークに接続されると、Serial Monitorに表示されるIPアドレスを
PCやスマートフォンのWebブラウザに入力することで、電圧モニターのWebページにアクセスできます。
最新値と平均値: ページ上部のテーブルには、各チャンネル（V1〜V4）の最新の電圧値と過去10分間の平均電圧値が表示されます。
リアルタイムグラフ: テーブルの下には、最新の30サンプルの電圧データが折れ線グラフで表示されます。このグラフは60秒ごとに自動更新されます。


2. データのエクスポート

CSVダウンロード: Webページ内の「CSVダウンロード」リンクをクリックすると、ESP32が保持している最大12時間分の
全生データと10分ごとの平均データをCSVファイルとしてダウンロードできます。
ダウンロードしたCSVファイルは、Excelなどの表計算ソフトウェアで開いて分析できます。


3. LEDインジケーター

緑LED:
電圧データを正常にサンプリングするたびに、短く点滅します。
赤LED:
Wi-Fi接続を試行中に点灯します。
Wi-Fi接続に失敗した場合、点灯し続けます。
4. 省電力動作

このシステムは、電圧サンプリングとWebサーバー処理の間にライトスリープモードに入ります。
これにより、バッテリー駆動時などの消費電力を抑えつつ、Webサーバー機能は維持されます。

インストール方法
1. 必要なもの

ESP32 開発ボード (例: ESP32-DevKitC, ESP32 WROOM-32D など)
Arduino IDE または PlatformIO がインストールされたPC
USBケーブル (データ通信が可能なもの)
Wi-Fiネットワーク (SSIDとパスワードが必要)
電圧入力源 (アナログピンに接続するセンサーや回路)
緑色LED、赤色LED、および適切な電流制限抵抗 (回路に組み込む場合)

2. Arduino IDE のセットアップ

ESP32ボードマネージャーのインストール:

Arduino IDE を開きます。
ファイル > 環境設定 を選択します。
「追加のボードマネージャーのURL」に以下のURLを追加します。 
https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
ツール > ボード > ボードマネージャー を開きます。
検索バーに「esp32」と入力し、esp32 by Espressif Systems をインストールします。
ライブラリのインストール:

このコードはArduino IDEに標準で含まれる WiFi.h, WebServer.h, time.h を使用しています。追加のライブラリインストールは不要です。


3. コードの準備

C++コードをコピーし、Arduino IDE の新しいスケッチに貼り付けます。

以下の行を、ご自身のWi-FiネットワークのSSIDとパスワードに書き換えます。

C++
const char* ssid = "YOUR_SSID";     // ここをあなたのWi-FiのSSIDに書き換える
const char* password = "YOUR_PASSWORD"; // ここをあなたのWi-Fiのパスワードに書き換える
 （オプション）デバッグ出力を無効にする場合は、以下の行を変更します。

C++
#define DEBUG_ENABLED false // デバッグ出力を無効化


4. 回路の接続

アナログ入力ピン:
V1: ESP32のGPIO34
V2: ESP32のGPIO35
V3: ESP32のGPIO32
V4: ESP32のGPIO33
これらのピンに電圧を供給するセンサーや回路を接続します。ESP32のADC入力は最大約3.3Vです。 
それ以上の電圧を入力する場合は、必ず分圧回路（例: 100kΩと15kΩの抵抗による分圧）を通して電圧を下げてください。
コード内のVOLTAGE_DIVIDER_RATIOは、100kΩと15kΩの抵抗を使った分圧回路を想定しています。
緑LED: ESP32のGPIO2 に、適切な電流制限抵抗（例: 220Ω〜1kΩ）を介して接続します。
赤LED: ESP32のGPIO4 に、適切な電流制限抵抗（例: 220Ω〜1kΩ）を介して接続します。
GND: すべてのコンポーネントのGNDをESP32のGNDに接続します。


5. ESP32への書き込み

ESP32ボードをUSBケーブルでPCに接続します。
Arduino IDE で、ツール > ボード から使用しているESP32ボードを選択します。
ツール > ポート から、ESP32が接続されているCOMポートを選択します。
スケッチ > 検証・コンパイル をクリックしてコードを検証します。
スケッチ > マイコンボードに書き込む をクリックして、ESP32にコードをアップロードします。
アップロードが完了したら、Arduino IDE の ツール > シリアルモニター を開き、ボーレートを 115200 に設定します。
Wi-Fi接続の進捗状況や、ESP32のIPアドレスが表示されます。
これで、ESP32が起動し、電圧監視とWebサーバー機能が開始されます。
